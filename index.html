<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Lector QR móvil — Exportar a Excel (CSV)</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="stylesheet" href="./index.css">
</head>
<body>
  <header class="wrap">
    <h1>Lector QR para móvil (web)</h1>
    <div class="sub">Escanea códigos QR, guárdalos localmente y descárgalos en CSV para Excel.</div>
  </header>

  <main class="wrap grid grid-cols-2" id="app">
    <section class="card">
      <div class="panel grid" style="gap:12px;">
        <div class="stats">
          <div class="chip">Total: <strong id="stat-total">0</strong></div>
          <div class="chip">Únicos: <strong id="stat-unique">0</strong></div>
          <div class="chip">Último: <strong id="stat-last">—</strong></div>
        </div>

        <div class="controls">
          <button id="btn-start" class="btn-primary">▶️ Iniciar cámara</button>
          <button id="btn-stop" class="btn-secondary" disabled>⏸️ Detener</button>
          <select id="camera-select" title="Selecciona cámara"></select>
          <button id="btn-refresh" class="btn-secondary">🔄 Actualizar cámaras</button>
          <!-- NUEVO -->
          <button id="btn-flip" class="btn-secondary">🔁 Cambiar cámara</button>
        </div>

        <div>
          <input id="dup" type="checkbox" /> <label for="dup">Permitir duplicados</label>
          <span class="note">(si está desmarcado, se ignoran códigos repetidos)</span>
        </div>

        <div id="qr-reader" class="card" aria-label="Visor de cámara">
          <span style="opacity:.6">Pulsa <strong>Iniciar cámara</strong> para empezar</span>
        </div>

        <div class="fallback card panel">
          <strong>¿La cámara no se activa?</strong>
          <ul>
            <li>Abre esta web en <strong>HTTPS</strong>.</li>
            <li>En iPhone usa <strong>Safari</strong> o <strong>Chrome</strong> (no dentro de apps).</li>
            <li>Plan B: <em>Subir foto</em> del QR.</li>
          </ul>
          <label class="btn-secondary" for="file-input">📷 Subir foto del QR</label>
          <input id="file-input" type="file" accept="image/*" capture="environment" style="display:none" />
        </div>

        <div id="msg" class="msg" role="status" aria-live="polite"></div>
      </div>
    </section>

    <aside class="card">
      <div class="panel grid">
        <div class="controls">
          <button id="btn-export" class="btn-primary">⬇️ Exportar CSV</button>
          <button id="btn-clear" class="btn-danger">🗑️ Borrar lista</button>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr><th style="width: 160px;">Fecha</th><th>Código</th></tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </aside>
  </main>

  <footer class="wrap">
    <div>Notas: requiere <span class="code">https://</span> (o <span class="code">localhost</span>) para acceder a la cámara. En iPhone/iPad usa Safari. Si lo abriste desde WhatsApp/Instagram, re-abre el enlace en el navegador del sistema.</div>
  </footer>

  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="./index.js" defer></script>
</body>
</html>
